<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Book Haven</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
    <custom-navbar></custom-navbar>


<!--    hello iam mahmoud-->
    

    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
            <button id="addBookBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-300 flex items-center">
                <i data-feather="plus" class="mr-2"></i> Add Book
            </button>
        </div>
        
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cover</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Author</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="booksTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Books will be loaded from JSON -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Add/Edit Book Modal -->
    <div id="bookModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-backdrop absolute inset-0"></div>
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 relative z-10">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Add New Book</h3>
                        <button title="add book"  type="button" id="closeModal" class="text-gray-500 hover:text-gray-700">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    
                    <form id="bookForm">
                        <input type="hidden" id="bookId">
                        <div class="mb-4">
                            <label for="title" class="block text-gray-700 mb-2">Title</label>
                            <input type="text" id="title" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div class="mb-4">
                            <label for="author" class="block text-gray-700 mb-2">Author</label>
                            <input type="text" id="author" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div class="mb-4">
                            <label for="summary" class="block text-gray-700 mb-2">Summary</label>
                            <textarea id="summary" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="category" class="block text-gray-700 mb-2">Category</label>
                            <input type="text" id="category" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div class="mb-4">
                            <label for="price" class="block text-gray-700 mb-2">Price</label>
                            <input type="number" step="0.01" id="price" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                        </div>
                        <div class="mb-4">
                            <label for="image" class="block text-gray-700 mb-2">Cover Image URL</label>
                            <input type="url" id="image" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="available" class="flex items-center">
                                <input type="checkbox" id="available" class="mr-2"> Available
                            </label>
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Save Book</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <custom-footer></custom-footer>

    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="script.js"></script>
    <script>
        feather.replace();
        
        // Check admin status
        if (localStorage.getItem('isAdmin') !== 'true') {
            window.location.href = 'admin-login.html';
        }
        
        // Load books into table
        function loadBooks() {
            const books = JSON.parse(localStorage.getItem('books')) || [];
            const tableBody = document.getElementById('booksTableBody');
            tableBody.innerHTML = '';
            
            books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <img src="${book.image || 'http://static.photos/books/200x200/1'}" alt="${book.title}" class="h-10 w-10 rounded-lg object-cover">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${book.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${book.author}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${book.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${book.price}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${book.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${book.available ? 'Available' : 'Out of Stock'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button data-id="${book.id}" class="edit-btn text-indigo-600 hover:text-indigo-900 mr-4">Edit</button>
                        <button data-id="${book.id}" class="delete-btn text-red-600 hover:text-red-900">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => editBook(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteBook(btn.dataset.id));
            });
        }
        
        // Edit book
        function editBook(id) {
            const books = JSON.parse(localStorage.getItem('books')) || [];
            const book = books.find(b => b.id == id);
            
            if (book) {
                document.getElementById('modalTitle').textContent = 'Edit Book';
                document.getElementById('bookId').value = book.id;
                document.getElementById('title').value = book.title;
                document.getElementById('author').value = book.author;
                document.getElementById('summary').value = book.summary;
                document.getElementById('category').value = book.category;
                document.getElementById('price').value = book.price;
                document.getElementById('image').value = book.image || '';
                document.getElementById('available').checked = book.available;
                
                document.getElementById('bookModal').classList.remove('hidden');
            }
        }
        
        // Delete book
        function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                let books = JSON.parse(localStorage.getItem('books')) || [];
                books = books.filter(b => b.id != id);
                localStorage.setItem('books', JSON.stringify(books));
                loadBooks();
                showAlert('Book deleted successfully', 'success');
            }
        }
        
        // Modal functionality
        document.getElementById('addBookBtn').addEventListener('click', () => {
            document.getElementById('modalTitle').textContent = 'Add New Book';
            document.getElementById('bookForm').reset();
            document.getElementById('bookId').value = '';
            document.getElementById('available').checked = true;
            document.getElementById('bookModal').classList.remove('hidden');
        });
        
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('bookModal').classList.add('hidden');
        });
        
        document.getElementById('cancelBtn').addEventListener('click', () => {
            document.getElementById('bookModal').classList.add('hidden');
        });
        
        // Form submission
        document.getElementById('bookForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('bookId').value || Date.now();
            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;
            const summary = document.getElementById('summary').value;
            const category = document.getElementById('category').value;
            const price = document.getElementById('price').value;
            const image = document.getElementById('image').value;
            const available = document.getElementById('available').checked;
            
            let books = JSON.parse(localStorage.getItem('books')) || [];
            
            if (document.getElementById('bookId').value) {
                // Update existing book
                books = books.map(b => b.id == id ? {
                    id, title, author, summary, category, price, image, available
                } : b);
            } else {
                // Add new book
                books.push({
                    id, title, author, summary, category, price, image, available
                });
            }
            
            localStorage.setItem('books', JSON.stringify(books));
            document.getElementById('bookModal').classList.add('hidden');
            loadBooks();
            showAlert('Book saved successfully', 'success');
        });
        
        // Initial load
        document.addEventListener('DOMContentLoaded', loadBooks);
    </script>
</body>
</html>